name: $(Major).$(CP).$(HF)+$(Patch)

trigger:
- master

pool:
  vmImage: 'windows-latest'

variables:
- group: Modules-Publishing
- name: Major
  value: 15
- name: CP
  value: 2
- name: HF
  value: 0
- name: Patch
  value: $[counter(format('{0}.{1}.{2}', variables['Major'], variables['CP'],variables['HF']),0)]

steps:
- task: NuGetToolInstaller@1

- task: UseDotNet@2
  displayName: Use .NET Core sdk 6.0.x
  inputs:
      version: 6.0.x

- task: DotNetCoreCLI@2
  inputs:
    command: 'custom'
    custom: 'new'
    arguments: 'tool-manifest'

- task: DotNetCoreCLI@2
  inputs:
    command: 'custom'
    custom: 'tool'
    arguments: 'update hopex.applicationserver.tool --version 15.3.*'
    
- task: CmdLine@2
  displayName: 'Publishing to mega store'
  inputs:
    script: 'dotnet has module create -s $(Hopex.StoreAddress) -t $(Hopex.StoreToken) -p . --version $(Build.BuildNumber).'
